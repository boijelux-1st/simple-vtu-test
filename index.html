<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>VTU Admin Dashboard</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; background: #f4f6f8; }
h1 { color: #003366; }
#dataBox { background:#fff; padding:15px; border-radius:8px; margin-bottom:20px; }
.admin { background:#fff; padding:15px; border-radius:8px; }
input, select, button { padding:8px; margin-top:6px; }
textarea { width:100%; height:80px; margin-top:6px; }
label { display:block; margin-top:10px; }
</style>
</head>
<body>

<h1>VTU Service Admin Dashboard</h1>

<div id="dataBox">
  <h2>Live Data</h2>
  <p><b>Balance:</b> <span id="balance">Loading...</span></p>
  <p><b>Transactions:</b></p>
  <ul id="transactions"><li>Loading...</li></ul>
  <button onclick="fetchData()">Refresh Now</button>
</div>

<div class="admin">
  <h2>Admin Controls</h2>
  <label>Update Price
    <input type="number" id="newPrice" placeholder="Enter new price"/>
    <button onclick="updatePrice()">Save Price</button>
  </label>

  <label>Send Custom API Command
    <textarea id="customBody" placeholder='{"param":"value"}'></textarea>
    <button onclick="sendCustom()">Send Command</button>
  </label>
</div>

<script>
const VTU_API_URL = "https://example.com/api"; // <-- saka VTU API base URL
const API_KEY = "YOUR_ADMIN_KEY"; // <-- saka key/token naka

async function fetchData() {
  try {
    const res = await fetch(`${VTU_API_URL}/status`, {
      headers: { "Authorization": `Bearer ${API_KEY}` }
    });
    const data = await res.json();
    document.getElementById("balance").textContent = data.balance || "N/A";

    const txList = document.getElementById("transactions");
    txList.innerHTML = "";
    (data.transactions || []).forEach(tx => {
      const li = document.createElement("li");
      li.textContent = `${tx.date}: ${tx.amount} (${tx.status})`;
      txList.appendChild(li);
    });
  } catch (err) {
    console.error(err);
    alert("Error fetching data");
  }
}

async function updatePrice() {
  const price = document.getElementById("newPrice").value;
  if (!price) return alert("Enter price first");
  try {
    const res = await fetch(`${VTU_API_URL}/update-price`, {
      method: "POST",
      headers: { 
        "Content-Type": "application/json",
        "Authorization": `Bearer ${API_KEY}`
      },
      body: JSON.stringify({ price: Number(price) })
    });
    if (!res.ok) throw new Error(await res.text());
    alert("Price updated successfully!");
    fetchData();
  } catch (err) {
    alert("Update failed: " + err.message);
  }
}

async function sendCustom() {
  const bodyText = document.getElementById("customBody").value;
  try {
    const res = await fetch(`${VTU_API_URL}/admin-action`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": `Bearer ${API_KEY}`
      },
      body: bodyText
    });
    if (!res.ok) throw new Error(await res.text());
    alert("Command sent!");
    fetchData();
  } catch (err) {
    alert("Command failed: " + err.message);
  }
}

// initial load
fetchData();
// auto-refresh every 10s
setInterval(fetchData, 10000);
</script>

</body>
</html>
